{"name":"Php-irc","tagline":"PHP-IRC is a modular IRC bot written in PHP5 with a combination of object based/oriented programming. It operates under several different platforms with the purpose of automating common information related tasks on IRC.","body":"+---------------------------------------------------------------------------\r\n|   PHP-IRC v2.2.1 Service Release\r\n|   ========================================================\r\n|   by Manick\r\n|   (c) 2001-2006 by http://www.phpbots.org/\r\n|   Contact: manick@manekian.com\r\n|   irc: #manekian@irc.rizon.net\r\n|   ========================================\r\n|   Special Contributions were made by:\r\n|   cortex\r\n+---------------------------------------------------------------------------\r\n|   > Documentation\r\n+---------------------------------------------------------------------------\r\n|   > This program is free software; you can redistribute it and/or\r\n|   > modify it under the terms of the GNU General Public License\r\n|   > as published by the Free Software Foundation; either version 2\r\n|   > of the License, or (at your option) any later version.\r\n|   >\r\n|   > This program is distributed in the hope that it will be useful,\r\n|   > but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n|   > MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n|   > GNU General Public License for more details.\r\n|   >\r\n|   > You should have received a copy of the GNU General Public License\r\n|   > along with this program; if not, write to the Free Software\r\n|   > Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.\r\n+---------------------------------------------------------------------------\r\n|   Changes\r\n|   =======-------\r\n|   > If you wish to suggest or submit an update/change to the source\r\n|   > code, email me at manick@manekian.com with the change, and I\r\n|   > will look to adding it in as soon as I can.\r\n+---------------------------------------------------------------------------\r\n\r\nNOTE! Please enable word-wrap to view this file.\r\nNOTE! PLEASE READ SECTION '3. Installation - A few things to consider' BEFORE USING.\r\n\r\nPlease visit our new mods/forums website here: http://www.phpbots.org/\r\n\r\nTable of Contents\r\n-----------------\r\n\r\n1. \tIntroduction and Release Notes\r\n1-a.\tWhat's new in 2.2.1!\r\n1-b.\tFeatures\r\n2. \tIncluded\r\n3. \tInstallation - A few things to consider\r\n3-a.\tQuick Install\r\n3-b. \tInstalling PHP 5\r\n3-c.\tUsing alternate PHP.INI (PHP Configuration) file\r\n3-d. \tInstalling PHP-IRC\r\n4. \tConfiguration\r\n5. \tRunning\r\n6. \tRemote Administration (via DCC and Private Message)\r\n7. \tFile Transfer\r\n7-a. \tFile Transfer behind a firewall or NAT\r\n8. \tModules and User-defined functions\r\n8-a. \tSubmitting modules for others to download\r\n9. \tQuerying outside servers (alternative to fopen, fsockopen, etc) READ THIS if you need this functionality!\r\n9-a.\tBasic Queries, using the addQuery() function\r\n9-b.\tIntro to Connection Class, Advanced Queries\r\n10. \tCustom DCC Chat Sessions\r\n10-a. \tCustom DCC Chat Example: Simple File Server (SFS)\r\n11. \tDatabase support\r\n11-a.\tMysql Database\r\n11-b.\tPostgre Database\r\n11-c.\tServerless, mIRC compatible ini-file based Database\r\n12. \tTimers\r\n13. \tMultiple servers under one process\r\n14.\tProvided Sample Modules\r\n14-a.\tIMDB Parser\r\n14-b.\tQuotes mod with mysql/ini file system\r\n14-c.\tSimple http server\r\n14-d.\tBash.org Parser\r\n14-e.\tNews System/Rules Script\r\n14-f.\tSeen System (beta!)\r\n14-g.\tRequest Ads System\r\n15. \tFunction Reference\r\n16.\tSpecial Thanks\r\n\r\n=================================\r\n1. Introduction and Release Notes\r\n=================================\r\nPlease visit our new website: http://www.phpbots.org/ for support and user-submitted modules.\r\n\r\nPHP-IRC is a totally php based irc bot meant to automate some applications related to irc.  I've personally programmed several modules which I currently use on irc.rizon.net.  This version is my attempt at bringing such a device to the public.  I hope you find it as useful as I do.  I have begun work on a module submission site which will be hosted at http://www.phpbots.org once finished.  I have already recieved modules from serveral enthusiastic people wishing to contribute in some way to the project.  Thank you for your time and effort.\r\n\r\nIt has always been my opinion that IRC scripting has long needed a simple programming interface that people with already existent skills could utilize.  There are two main reasons that PHP was selected as the primary language.  First off, I wanted to provide novice programmers a way to code their own functions and algorithms into a powerful platform without having to worry about such things as memory management and compilers.  Secondly, I wanted to do something that no one has done before--create a fully featured bot in php.   I don't know if I will ever complete the second objective, but I will keep on developing, as it will always be the main goal of this project.    \r\n\r\nIf I have left out information in this file, or there is something I said that confused you, please email me your concerns at manick@manekian.com, and I will try to clarify where you were confused.  This will also help me determine what I need to fix in this file for the next version.\r\n\r\n\r\n=========================\r\n1-a. What's new in 2.2.1!\r\n=========================\r\nAs this is a service update and not a full release, the readme file included below has not been altered from the 2.2.0 version.  Version 2.2.1 brings several bug fixes (which are viewable in changes.txt).\r\n\r\nDevelopment on PHP-IRC is not halted, simply stalled, as I am approaching the culmination of my college career.  Thank you for your continued interest in PHP-IRC.\r\n\r\nWe have a new website!  Please view it here: http://www.phpbots.org/\r\n\r\n=============\r\n1-b. Features\r\n=============\r\nFor a full list of current major features, please visit: http://www.phpbots.org/\r\n\r\n===========\r\n2. Included\r\n===========\r\n\r\nCore Files:\r\n\t==============\r\n\tConfig Files\r\n\t--------------\r\n\tbot.conf\r\n\tfunction.conf\r\n\ttypedefs.conf (added 2.2.0)\r\n\tmodules/default/priv_mod.conf (added 2.2.0)\r\n\tmodules/default/dcc_mod.conf (added 2.2.0)\r\n\t==============\r\n\tReadme Files\r\n\t--------------\r\n\treadme.txt\r\n\tmodules/template.txt (added 2.1)\r\n\tgpl.txt (added 2.1)\r\n\tcommand_reference.txt (added 2.1.1)\r\n\tchanges.txt (added 2.1.1)\r\n\tupgrade-2.1.1-2.2.0.txt  (added 2.2.0)\r\n\tinstall.txt  (added 2.2.0)\r\n\t==============\r\n\tSource code\r\n\t--------------\r\n\tbot.php\r\n\tchat.php (added 2.1)\r\n\tconnection.php (added 2.2.0)\r\n\tdcc.php\r\n\tdefines.php (added 2.0.1/2)\r\n\terror.php\r\n\tfile.php (added 2.1)\r\n\tirc.php\r\n\tmodule.php (added 2.2.0)\r\n\tparser.php\r\n\tqueue.php (added 2.2.0)\r\n\tremote.php (added 2.2.0)\r\n\tsocket.php\r\n\ttimers.php\r\n\tmodules/default/dcc_mod.php (added 2.1)\r\n\tmodules/default/priv_mod.php (added 2.1)\r\n\r\n==========================================\r\n3. Installation - A few things to consider\r\n==========================================\r\n\r\nI've been getting a lot of emails and private messages on rizon about how to run this bot via a web browser.  However, most webhosts do not compile php with socket support enabled, and for that matter, most web hosts don't have php5 as of yet.  Even so, in order to start the bot, you have to specify a config file on the command line.  Thus, running this bot from a web browser without modification is impossible.  I will not make this possible, so in other words, please stop asking.\r\n\r\nAnother thing that might deter people from using this script is the enourmous memory requirement by php to keep\r\na script loaded in memory.  PHP5 loads all of the program and everything it could possibly use into memory.  This can take up quite a bit of space!  I've had a bot use 8 megs of ram on the low end, and up to 15 megs on the high end.  If you don't mind dropping 15 megs of ram for this bot, then continue on.  Otherwise, don't whine to me that its a resource hog.  I believe the advantages far outweigh the disadvantages--how else could I have gotten this far?\r\n\r\nIn order to run this bot, you must have shell access to the box you will be running it on.  For instructions on how to install php5 for use with this bot, please see the next section, \"Installing PHP 5\".\r\n\r\nA note about errno constants:\r\n-----------------------------\r\n\r\nIn unix/windows/etc, when trying to write or read from a socket sometimes (a socket is the connection between your computer and another computer), errors occur.  In order to be able to determine what these errors are, all systems have something called 'errno' constants.  Unfortunatly, PHP5 does not know these constants, so we have to set them manually in order for this program to run.  In the defines.php file, I have set common values for windows, freebsd, linux, and unix.  If you are using one of these systems, an autodetection script should take care of detecting which system you are running the bot on, and set the appropriate values.  If this does not work, and you cannot connect to a server, you may need to set your OS type to either \"windows\", \"freebsd\", \"linux\", or \"unix\".  If you do not experience problems with this, then skip down to \"Installing PHP 5\".  Otherwise, keep reading.\r\n\r\nI have run this successfully on Windows XP, Mandrake 9.0 Linux, and Debian.  If this program does not work with any of the os settings for OS in defines.php, you need to find the correct values for EAGAIN, EINPROGRESS, EALREADY, and EISCONN(these are those error constants that I was talking about earlier) for your system.\r\n\r\nThey are usually in /usr/include. You can find them by using a command sequence such as this:\r\n\r\n-------------------------------------------------------------------------------\r\ngrep -r 'EAGAIN' /usr/include/*\r\ngrep -r 'EINPROGRESS' /usr/include/*\r\ngrep -r 'EALREADY' /usr/include/*\r\ngrep -r 'EISCONN' /usr/include/*\r\n-------------------------------------------------------------------------------\r\n\r\nAfter doing this, you'll get a line that looks like this:\r\n\r\n-------------------------------------------------------------------------------\r\n/usr/include/asm/errno.h:#define        EISCONN         106     /* Transport endpoint is already connected */\r\n-------------------------------------------------------------------------------\r\n\r\nThe constant we are looking for is 106.  Now, after finding all those numbers, go into defines.php.  Set your OS type to \"unknown\"; then, scroll down a bit till you find this code:\r\n\r\n-------------------------------------------------------------------------------\r\nif ($OS == 'unknown')\r\n{\r\n\tdefine('EAGAIN', \t0); \t/* Try again */\r\n\tdefine('EISCONN', \t0);\t/* Transport endpoint is already connected */\r\n\tdefine('EALREADY',\t0);\t/* Operation already in progress */\r\n\tdefine('EINPROGRESS',\t0);\t/* Operation now in progress */\r\n}\r\n-------------------------------------------------------------------------------\r\n\r\nNow, change the numbers, etc, with the corresponding values you got when you found the constants above.  Do this with all four constants, and then move on to the next section.\r\n\r\n==================\r\n3-a. Quick Install\r\n==================\r\n\r\nRunning php-irc consists of 6 general steps (EXPERTS ONLY!):\r\n\r\n1) Download and unpack, compile the php 5 5.0.2+ package with sockets and pcntl.\r\n2) Edit the php.ini file following the steps in section 3-b (bottom half of section under \"First, locate this line in the file:\")\r\n3) Unzip php irc\r\n4) If the bot does not start up and connect to the server, you may have to set the OS parameter in the defines.php file.  Read the previous section.\r\n5) Change server/port information in bot.conf.  You can run php-irc with the -c switch to get an md5 password hash to set dccadminpass with.\r\n6) run php-irc with: /path/to/php/php.exe bot.php bot.conf from the php-irc directory, or edit the shebang line and change it to reflect your php location, (also use -c switch to specify php.ini location), and then chmod the bot.php file 755, and run with ./bot.php bot.conf\r\n\r\nOf course, I recommend that you read the rest of this file, as it provides some very important information.\r\n\r\n=====================\r\n3-b. Installing PHP 5\r\n=====================\r\n\r\nPlease read the following notices before continuing to install:\r\n\r\nNotice 1:\r\n---------\r\nDo not use this bot with alpha/beta versions of php5.  I have successfully run it on rc2/rc3, however.\r\n\r\nNotice 2:\r\n---------\r\nDo not use this bot with php 5.0.0 or 5.0.1.  These versions have a bug which makes it work incorrectly.  If you would like to find out more about this bug, view this page: http://bugs.php.net/bug.php?id=28892\r\n\r\nInstallation: (see below for installations on linux)\r\n\r\n---------------------\r\nInstalling on Windows\r\n---------------------\r\nDownload PHP5 from this location: 'http://www.php.net/downloads.php'.  Select the latest PHP 5 zip package under \"Windows Binaries\".  Unzip this to a folder, c:\\php, for instance.\r\n\r\nThen, copy the included 'php.ini-dist' file in the c:\\php directory to 'c:\\windows\\php.ini'.  Open this file with notepad or your favorite text editor. (Usually, you can right click the file and hit 'open with').\r\n\r\nFirst, locate this line in the file:\r\n---------------------------------------------------------------------------\r\n; This directive tells PHP whether to declare the argv&argc variables (that\r\n---------------------------------------------------------------------------\r\n\r\nA few lines below this, you'll see this directive:\r\n--------------------------------\r\nregister_argc_argv\r\n--------------------------------\r\nMake sure that this line says:\r\n--------------------------------\r\nregister_argc_argv = On\r\n--------------------------------\r\n\r\nNow, locate this line:\r\n--------------------------------\r\nextension_dir = \"./\"\r\n--------------------------------\r\nChange this to:\r\n--------------------------------\r\nextension_dir = \"./ext\"\r\n--------------------------------\r\n\r\nIf you are going to use a mysql database, find:\r\n------------------------\r\n;extension=php_mysql.dll\r\n------------------------\r\nAnd change to:\r\n------------------------\r\nextension=php_mysql.dll\r\n------------------------\r\n\r\nThen find:\r\n--------------------------------\r\n;extension=php_sockets.dll\r\n--------------------------------\r\nAnd change to:\r\n--------------------------------\r\nextension=php_sockets.dll\r\n--------------------------------\r\n\r\nYou are now set to run PHP-IRC.  See section \"Configuration\" for information related to configuring the bot.\r\n\r\n-------------------\r\nInstalling on Linux\r\n-------------------\r\nDownload php from php website, here: 'http://www.php.net/downloads.php'.  Select the latest php5 tar.gz package under \"Complete Source Code\".\r\n\r\nExtract this file.  To do this, copy the file to your home directory.  Then, extract it using this command:\r\n\r\ntar -zxf php-<your version>.tar.gz\r\n\r\nReplace <your version> with your version of PHP.  Make sure it is 5.0.2 or greater!\r\nNow, run this command:\r\n\r\ncd php-<your version>/\r\n\r\nAlso make sure to replace <your version> with your php5 version.\r\nNow, we have a few things to consider here.  Do you want to run a mysql database or not?  If you do, then use this command:\r\n\r\n./configure --enable-sockets --enable-pcntl --with-mysql\r\n\r\nHowever, if you do not have mysql installed on your system, do this:\r\n\r\n./configure --enable-sockets --enable-pcntl\r\n\r\nIf for any reason this fails, please read below.  If it does not, skip these next few paragraphs.\r\n\r\nUsually the configure script fails when it cannot find a module or package it needs to compile.  Sometimes I have had it fail with the 'XML LIB' package, saying it could not be found.  In order to rectify this, use this command:\r\n\r\n./configure --help\r\n\r\nAnd then search through the output, looking for the package that failed.  See if there is a --disable-<package> option that you can add to the ./configure command above, which will make it skip that package.  Then, run the configure command again, until you remove all packages that do not work with your system.\r\n\r\nContinuing on\r\n-------------\r\n\r\nNow, after you see the \"Thanks for using PHP\" message, run the following command:\r\n\r\nmake\r\n\r\nAfter this is completed, you are all done installing php!  You will need to copy the binary to a usable and NON WEB ACCESSABLE directory, by using this command:\r\n\r\ncp sapi/cli/php /<my directory>/\r\n\r\nWhere <my directory> is the directory you wish to copy it to.  When I say NON WEB ACCESSABLE, I mean that you could not access this file directly from the web.\r\n\r\nYou are now set to run PHP-IRC.  See section \"Configuration\" for information related to configuring the bot.\r\n\r\n=====================================================\r\n3-c. Using alternate PHP.INI (PHP Configuration) file\r\n=====================================================\r\n\r\nYou may be running another version of php on the server that you run this on specifically for apache, or some other purpose.  In this case, you already have a php.ini file in /etc.  You can use an alternate php.ini file by using this syntax when running php:\r\n\r\n/path/to/php.exe -c /dir/of/php.ini/ bot.php bot.conf\r\n\r\nIf on linux, you can also chmod bot.php 755, and then edit the #! line at the top of the file to look like this:\r\n\r\n#!/path/to/php -c /dir/of/php.ini/\r\n\r\nAnd then you can run php-irc like this:\r\n\r\n./bot.php bot.conf\r\n\r\n=======================\r\n3-d. Installing PHP-IRC\r\n=======================\r\nIf you are reading this file, you have already downloaded and unpacked the source package from sourceforge.net.  Good, the hard part is out of the way.  Continue on to the next section.\r\n\r\n\r\n================\r\n4. Configuration\r\n================\r\n\r\nPHP5\r\n----\r\nPlease see above, our guide to \"installing php 5\" for configuration options to php.ini.\r\n\r\ndefines.php\r\n-----------\r\nThe main things you need to look at in here is DEBUG mode and OS. DEBUG 1 will make it so everything that happens to the bot is printed in the main window.  DEBUG 0 will instead print it to a logfile specified in bot.conf. Make sure that you set your OS to either linux, unix, windows or bsd, otherwise your bot won't run (if autodetection fails).\r\n\r\nThe lines you need to change are:\r\n\r\ndefine('DEBUG', 1);\r\n\r\nand:\r\n\r\ndefine('OS', 'windows');\r\n\r\nYou might also want to change the name of the PID file that is written when you run the bot in background mode.  You can edit that filename with this line:\r\n\r\ndefine('PID', \"bot.pid\");\r\n\r\nbot.conf\r\n--------\r\nEdit this file and change all the options to your liking.  Of special interest should be natip, which allows you to work from behind a nat.  Also, as of 2.1, pay special attention to the 'upload' and 'uploaddir' parameters.  You can accept file transfers with those.  Please also look at dccadminpass.  You will need to set this in order to use dcc chat or private message administration of your bot.  You will need to run 'bot.php -c password' to generate an md5 password hash of 'password'.\r\n\r\nfunction.conf\r\n-------------\r\nThis file is a little more complicated.  php-irc will respond to various text typed in a channel (triggers).  You can configure those triggers in this file.  Please see the section titled \"Modules and User-defined functions\" for help with this file.\r\n\r\nAt this point, you should be able to start up your bot--although it won't do much.  See the section \"Modules and User-defined functions\" for information about adding functionality.\r\n\r\n\r\n==========\r\n5. Running\r\n==========\r\nRunning this bot is rather simple.\r\n\r\nWindows:\r\n--------\r\n\r\nRun the bot with the following command:\r\n\r\nc:\\php\\php.exe bot.php bot.conf\r\n\r\nMake sure that this is the correct path that php is in.  You may need to change 'c:\\php' to the directory where your php5's php.exe resides.  Make sure, also, that you are located in your php-irc main directory when you start the bot. i.e.,\r\n\r\ncd <my php-irc directory>\r\n\r\nI have a little trick.  I make a windows shortcut (.lnk file) to php.exe, and put it in my php-irc directory.  Then I edit the shortcut and make sure that my working directory is my php-irc directory.  Then, I can run the bot as such:\r\n\r\nphp.lnk bot.php bot.conf\r\n\r\nLinux:\r\n------\r\nThe basic syntax is:\r\n\r\n/path/to/php5/php bot.php bot.conf\r\n\r\nIf you followed my php5 installation instructions, /path/to/php5/ would be the <my directory> that we talked about earlier.\r\n\r\nLinux Alternative:\r\n\r\nYou can edit the #! line in bot.php to reflect your php cgi binary location, and 'chmod 755 bot.php'.  This will make 'bot.php' executable.  You can then run it as such:\r\n\r\n./bot.php bot.conf\r\n\r\nYou can also run several different configurations under the same process.  Simply make another bot.conf file and then run it like this:\r\n\r\n./bot.php bot.conf bot2.conf\r\n\r\nIf you are on linux/unix, you can also run in the background by using the -b switch:\r\n./bot.php -b bot.conf\r\nHowever, in order for this to work, you need to set DEBUG mode to 0 in defines.php. (otherwise your bot won't spawn)  Also keep in mind that errors will not be displayed when in background mode.  Although text is logged to log.txt or whatever file you choose, the errors are not.  I will work on this for future versions.  However, if you're going to be doing a lot of debugging and are going to want to see all errors, you may want to keep DEBUG=1 and then use a program such as nohup to start the bot:\r\n\r\nnohup ./bot.php bot.conf\r\n\r\nIf this doesn't work as expected, delete the 'fclose(STDOUT)' line in bot.php and try running it like this:\r\n\r\nnohup ./bot.php bot.conf -b\r\n\r\n\r\n======================================================\r\n6. Remote Administration (via DCC and Private Message)\r\n======================================================\r\n\r\nYou can administer your bot via private messages (i.e., /msg php-irc <command>), or via dcc chat interface.  However, in order to use these features, make sure that the 'dccadminpass' setting in bot.conf is uncommented, (remove the ';'), and make sure that you change the password to something people can't guess.  You need to specify a password hash here, and you can do that by running:\r\n\r\nWindows\r\n-------\r\ndrive:\\path\\to\\php.exe bot.php -c <password>\r\n\r\n*nix\r\n----\r\n/path/to/php bot.php -c <password>\r\n\r\nWhere <password> is your password you wish to use.  This will generate an md5 hash of '<password>', and you can replace the dccadminpass setting in bot.conf with this value.\r\n\r\nVia private message, you can access admin commands like so (if you are using mIRC):\r\n\r\n/msg <mybot> admin <mypass> <command>\r\n\r\nWhere <mybot> is the nick of your bot, <mypass> is the password you selected for dccadminpass, and <command> is the command you will use.  You can get a list of commands by using the command 'help'.\r\n\r\nTo use the dcc chat administration interface, use:\r\n\r\n/msg <mybot> admin <mypass> chatme\r\n\r\nThe bot should then send you a dcc chat request.  You will have to type in your password to validate your session, which is just the password you set with dccadminpass again.  Then, you can type 'help' for a list of commands.\r\n\r\n\r\n================\r\n7. File Transfer\r\n================\r\n\r\nThis bot supports file transfers now.  I will implement a speed capping system in a later version.  For right now, you can send/recieve files at your max bw potential.  Really fast transfers (in the line of 100 mbit) take up nearly 99% of your CPU, however.  The system supports resume, as well as the mIRC File Server protocol (see below for configuration)\r\n\r\nTo send someone a file, use: \r\n\r\nSEND <nick> /path/to/file\r\n\r\nYou can use 'DCC' for speed/eta, although it doesn't work very well. Its based off of 3 second averages. Oh, and you can use 'CLOSE id' to close a specific transfer.  These id's are the numbers between the brackets ([ and ]) when you run the 'DCC' command.\r\n\r\nNOTE! This may be a security risk, as people with admin access could send themselves any file on your computer with it.  You may want to disable this function in the function.conf file if you feel this may be a problem. (just comment it out by putting a ';' in front of the line, or removing the line completely)\r\n\r\n===========================================\r\n7-a. File Transfer behind a firewall or NAT\r\n===========================================\r\n\r\nTo setup the bot to work behind a NAT (i.e., you are a computer behind a router, and you do not have a net-accessable IP, like 192.168.1.100), you can use the 'natip' setting in bot.conf.  Then, you can set the 'dccrangestart'  item to choose what port file transfers will use for outsiders to connect.  Normally, the bot will use port 1024+, but if you are using forwarded ports, you can set this setting to use those ports.\r\n\r\nIf you are behind a firewall, and cannot use the natip feature:\r\nThis bot also supports the mIRC reverse dcc protocol.  The mIRC File Server protocol can be turned on by uncommeting the 'mircdccreverse' setting in bot.conf.  The 59 there is just the port that you will connect to.  Common numbers are 59 and 212.  \r\n\r\n=====================================\r\n8. Modules and User-defined functions\r\n=====================================\r\n\r\nModules are what add the functionality to php-irc.  You can run php-irc by itself, and it may come with some pre-programmed features, but other than that it doesn't do much.  You need to extend it by adding modules that other people have written, or by writing modules yourself.  In this section, I will attempt to guide you through the process of doing just that.\r\n\r\nModules reside in the 'modules/' directory.  I have several modules in this directory already, and you can read about them in the section \"Provided Sample Modules\".\r\n\r\nA php-irc module is a user defined class inside of a file in the modules/ directory.  See \"template.txt\" in the modules/ directory for instructions on how to setup a class.  The basic declaration of a module class is as follows:\r\n\r\nclass class_name extends module {\r\n\r\n\t//Other stuff, can be found in template.txt\r\n\r\n}\r\n\r\nThis declaration syntax is INCREDIBLY important.  You MUST have the format:\r\n\r\nclass[space]class_name[space]extends[space]{\r\n\r\nIn order for the dynamic module support in PHP-IRC 2.2.0 to work, class definitions for modules must be defined in this way.  If you have outside classes to include, you must include them with \"require_once()\", instead of \"require()\".\r\n\r\nNow, say that we created a module; we copied template.txt to my_mod.php, and changed \"class_name\" to \"my_mod\" inside my_mod.php.  Now, we will have to declare this module inside function.conf.\r\n\r\nfunction.conf\r\n-------------\r\nThere are three main types of directives that you can set in this file.  Types, Commands, and Includes.  A \"Type\" statement is a statement which declares a format for a \"Command\" to use.\r\n\r\nFor instance, if I had a type, \"notice\", and I wanted it to have the arguments \"module\", and \"function\", I would do this as follows:\r\n\r\ntype notice module function\r\n\r\nNow, I can create commands that use type \"notice\".  Here is an example of a command that uses type \"notice\":\r\n\r\nnotice my_mod my_function\r\n\r\nThus, whenever a \"notice\" event took place on IRC, the function \"my_function\" in \"my_mod\" would be run with various useful parsed parameters passed. (Discussed Later)\r\n\r\nNote the \"module\" and \"function\" arguments.  These are required arguments.  This means for every single type declared, there must be a \"module\" and \"function\" argument specified, because if these didn't exist, what would be the point of catching the event?\r\n\r\n\"Include\" statements specify external function files to include into the main function.conf file.  They are useful when packaging a module with several function.conf statements.  Instead of copying/pasting all the statements on installation of the module, one need only to instruct a user to include a statement such as this:\r\n\r\ninclude modules/my_mod.conf\r\n\r\nNow to get a little more complicated:\r\n-------------------------------------\r\nIn addition to parsing standard irc messages and events and defining functions to parse them, the bot comes with 4 standard types.  These types are \"priv\", \"dcc\", \"ctcp\", and \"file\". The \"file\" type is used to include module files and their associated functions into the bots runtime code.  The \"ctcp\" type makes parsing mIRC's \"/ctcp\" commands simpler.  This could also be done by using a \"privmsg\" type and then parsing the line manually (to remove the ctcp characters), but its simpler to just do it this way.  The \"priv\" type handles text typed in a channel.  Thus, we can capture \"!ad\" or other triggers with this.  The \"dcc\" type handles text typed in the standard user and admin dcc chat interface.\r\n\r\nfile\r\n----\r\nYou use this to declare and include modules into php-irc.  The syntax is as follows:\r\n\r\nfile\t\t- the type\r\nname\t\t- the module (or name of the class in the file)\r\nfilename\t- the filename to include (the file that the class resides in)\r\n\r\nExample:\r\n\r\nfile priv_mod modules/priv_mod.php\r\n\r\nFilenames with spaces can be enclosed with quotes:\r\n\r\nfile priv_mod \"modules/My totally kick ass mod.php\"\r\n\r\npriv\r\n----\r\nThe \"priv\" type comes with several parameters, each explained below:\r\n\r\npriv\t\t- the type\r\nname\t\t- the trigger typed into the channel, i.e., \"!ad\"\r\nactive\t\t- whether this particular function is active (can be triggered)\r\n\t\t  when the bot starts up\r\ninform\t\t- Inform the administrator (through dcc chat interface, when the admin\r\n\t\t  is logged in) that someone used this function.\r\ncanDeactivate\t- admin can deactivate this function using FUNCTION command in dcc interface\r\nusage\t\t- how many times this function was used\r\nmodule\t\t- the module that the function is located in\r\nfunction\t- the function in the module specified above that is run\r\n\r\nAn example of a command that uses the \"priv\" type is defined below:\r\n\r\npriv !ad true true true 0 priv_mod priv_ad\r\n\r\nThe \"!ad\" command uses the function \"priv_ad\" in the \"priv_mod\" module.  So whenever someone types in a channel:\r\n\r\n!ad <some arguments>\r\n\r\nThe priv_ad function in priv_mod will be called to handle the arguments and respond to the user.\r\n\r\ndcc\r\n---\r\nThe \"dcc\" type comes with several parameters, each explained below:\r\n\r\ndcc\t\t- the type\r\nname\t\t- the command typed, i.e., \"HELP\"\r\nnumArgs\t\t- the expected number of arguments for this command\r\nusage\t\t- a string containing an overview of arguments, i.e., \"<id> <nick>\"\r\nhelp\t\t- a string containing information about what the command does\r\nadmin\t\t- whether this command is only available in the admin interface, or can be used in the standard user                    dcc chat interface\r\nmodule\t\t- the module that the function is located in\r\nfunction\t- the function in the module specified above that is run\r\nsection\t\t- the section the command is displayed in in dcc chat interface (explained below)\r\n\r\nAn example of a command that uses the \"dcc\" type is defined below:\r\n\r\ndcc raw 1 \"<raw query>\" \"Sends raw query to server\" true dcc_mod dcc_raw standard\r\n\r\nYou might also notice that in this case we used quotes.  Quotes can be used for any string longer than 1 word.  Single and Double quotes are allowed.  Escape double/single quotes inside the quotes with a backslash: i.e., \"Who\\'s there?\".  This does not follow the standard convention for escaping quotes.  So, even if you use double quotes to specify a multi-word string, you must still escape single quotes.\r\n\r\nsection\r\n-------\r\nIn the dcc command above, the \"section\" argument was used, and specified as \"standard\".  PHP-IRC 2.2.0 comes with a new ability to package dcc commands with sections.  Thus, when someone types \"Help\" in dcc chat, all of the functions are organized by category.\r\n\r\nA section can be declared with the following arguments:\r\n\r\nname\t\t- a small idname to be used in 'dcc' statements\r\nlongname\t- a usually quoted string which speicfies this sections title\r\n\r\nPHP-IRC comes with a few pre-defined sections which include 'standard', 'channel', 'dcc', 'info', 'admin', and 'comm'.  The declaration for the standard section type is shown below:\r\n\r\nsection\tstandard \"Standard Functions\"\r\n\r\nYou can of course specify your own sections in the same manner; say, for a custom module perhaps.\r\n\r\nctcp\r\n----\r\nThis is a shortcut to parsing commands sent to this bot with mIRC's /ctcp command.  The format is as follows:\r\n\r\nctcp\t\t- the type\r\nname\t\t- the trigger, i.e., \"files\" (see fileserver example in function.conf)\r\nmodule\t\t- the module that the function is located in\r\nfunction\t- the function in the module specified above that is run\r\n\r\nSee the fileserver ctcp command in modules/fileserver/fileserver.conf for an example.\r\n\r\nNow that you know what function.conf is and how it works:\r\n---------------------------------------------------------\r\n\r\nSuppose we have a random function in a module we've written, such as the one defined in the next section titled \"Querying Outside Servers\" named \"query\".  Having the functon is all fine and dandy, but how do we access it?  That is where function.conf comes in.  We will specify a trigger which can be used to access the query function during runtime.  First, we have to include our module:\r\n\r\nfile my_mod modules/my_mod.php\r\n\r\nWe'll pretend that this is where the 'query' function resides for the moment.  Now, lets say we want to run that function every time someone types '!info' in the channel.  To do this, we would add (below all the type declarations, and below the 'file' declaration we just made above):\r\n\r\npriv !info true true true 0 my_mod query\r\n\r\nThus, every time someone typed !info in the channel, the function 'query' would run.  This is the main basis for php-irc.  It is the heart of its purpose--responding to triggers.\r\n\r\nCreating Functions to Respond to Triggers\r\n-----------------------------------------\r\nNow that you know how to create modules, and specify them in function.conf, we will now cover writing your own functions to handle these triggers.  There are four main types of functions that you will write.  \"timer\" functions, \"standard\" functions, \"query\" functions, and \"dcc\" functions.\r\n\r\nstandard\r\n--------\r\nStandard functions are the functions which handle all the non-dcc type command statements declared in function.conf.  Remember our example earlier, when a user could type '!info' in the channel.  This triggered the 'query' function in the module 'my_mod'.  A sample declaration of this function could be:\r\n\r\n  public function query($line, $args)\r\n  {\r\n    //your code\r\n  }\r\n\r\nNotice the \"$line, $args\".  The declarations for 'query', 'dcc', and 'timer' functions all use different values here.  They are shown below:\r\n\r\n  public function standard($line, $args)\r\n  public function query($line, $args, $result, $response)\r\n  public function timer($arguments)\r\n  public function dcc($chat, $args)\r\n\r\nDefinitions of variables\r\n------------------------\r\n\r\n$line\r\n-----\r\nLine is an array containing a parsed version of the raw line sent from the server.  A raw line sent from the server could look like this:\r\n\r\n:Manick!~bugs@Rizon-2EFC6E17.resnet.purdue.edu PRIVMSG #manekian :!ad\r\n\r\nWe need to parse this into meaningful parts in order to do anything with the bot.  The $line array does that:\r\nfrom\t\t=> full nick/ident/host, in this case: \"Manick!~bugs@Rizon-2EFC6E17.resnet.purdue.edu\"\r\nfromNick\t=> only nick, in this case, \"Manick\"\r\nfromHost\t=> only host, in this case, \"Rizon-2EFC6E17.resnet.purdue.edu\"\r\nfromIdent\t=> The Ident of the user, in this case, \"~bugs\" \r\ncmd\t\t=> irc command used, (i.e., PRIVMSG, NOTICE, 366, 353, etc), in this case \"PRIVMSG\"\r\nto\t\t=> who this command was directed at (channel or your nick), in this case, \"#manekain\"\r\ntext\t\t=> everything after : in the line; basically the text of what someone says, in this case, \"!ad\"\r\nparams\t\t=> useful when parsing 'mode' commands etc. in this case, \":!ad\"\r\nraw\t\t=> the full untouched line.\r\n\r\nTo access an element in $line, reference it as such:  $line['element'], such as: \r\n\r\n$line['fromNick']\r\n\r\nThis would return \"Manick\", in this case.  Sometimes these variables are not populated perfectly.  In a particular circumstance, you can use:\r\n\r\nprint_r($line);\r\n\r\nby itself to to print the contents of the $line variable to the screen while in debug mode.\r\n\r\n$args\r\n-----\r\nThis is a simple array created from the $line['text'] variable.  It contains the following data:\r\n\r\nnargs\t\t=> the number of arguments\r\ncmd\t\t=> the command used\r\narg1\t\t=> present if there are 1 arguments or more\r\narg2\t\t=> present if there are 2 arguments or more\r\narg3\t\t=> present if there are 3 arguments or more\r\narg4\t\t=> present if there are 4 arguments or more\r\nquery\t\t=> The full text (all of args put together)\r\n(there are no more after arg4..)\r\n\r\nSo, if I typed \"!ad 60 Here is an ad that I want to talk about...\":\r\n\r\nnargs would be \"4\" (yes, 4)\r\ncmd would be \"!ad\"\r\narg1 would be \"60\"\r\narg2 would be \"Here\"\r\narg3 would be \"is\"\r\narg4 would be \"an\"\r\nquery would be \"60 Here is an ad that I want to talk about...\"\r\n\r\nThe maximum arguments can be set by the MAX_ARGS define in the defines.php.  It was chosen to be four for performance reasons.\r\n\r\n$result\r\n-------\r\nThis is discussed in the next section \"Querying Remote Servers\"\r\n\r\n$response\r\n---------\r\nThis is discussed in the next section \"Querying Remote Servers\"\r\n\r\n$arguments\r\n----------\r\nWhen creating a timer,  you can specify one argument, whether it be a string, array, or object, to send to a timer function every time that timer runs.  Timers are discussed in a later section.\r\n\r\n$chat\r\n-----\r\nThis is the object containing the current session of the user who typed the command in the dcc chat window.  $args for dcc functions is the same as $args above.\r\n\r\nSending messages and responding to users\r\n----------------------------------------\r\n\r\nAfter you've received a query and processed it, you might want to send back information.  There are several functions that can be used to do just that:\r\n\r\n$this->ircClass->sendRaw($text); //send raw data to server\r\n$this->ircClass->notice($line['fromNick'], $text, $queue = 1);  // (where $queue defaults to 1.. meaning its not\r\n\t\t\t\t\t\t\t\t// sent right away.\r\n$this->ircClass->privMsg($line['fromNick'], $text, $queue = 1); // $line['fromNick'] can also be the channel\r\n\t\t\t\t\t\t\t\t// which is usually $line['to'].\r\n$this->ircClass->action($line['fromNick'], $text, $queue = 1);  // does the '/me' thing that mIRC does\r\n\r\nTo send data to dcc users, use:\r\n\r\n$chat->dccSend(\"text here\"); \r\n\r\nTo send a CTCP messege, do this:\r\n\r\n$cmd = \"VERSION\";\r\n$msg = \"\";\r\n$this->ircClass->privMsg($line['fromNick'], chr(1) . trim(strtoupper($cmd) . \" \" . $msg) . chr(1));\r\n\r\nWhere $cmd is the command, like \"VERSION\", or \"ACTION\", and $msg is the parameters to the command.\r\n\r\n$queue\r\n------\r\nphp-irc maintains a text queue, so that it does not flood the server with text.  This is not a perfect system, and still fails ocassionaly, but works for the most part.  If $queue is set to 1, or not specified at all, then $text will be appened to the end of the queue waiting to be sent to the server.  Otherwise, if you set it to 0, it will be prepended to the beginning of the text queue.\r\n\r\n\r\nNow you should know all you need to know to write your own modules for php-irc.\r\n\r\n\r\n==============================================\r\n8-a. Submitting modules for others to download\r\n==============================================\r\n\r\nI am currently working on a site to submit modules.  This site will be http://www.phpbots.org when finished.\r\n\r\n===========================\r\n9. Querying outside servers\r\n===========================\r\n\r\nYou may need to read the section titled: \"Modules and User-defined functions\" before reading this.\r\n\r\nSometimes when programming a module, you might find it necessary to parse some webpage to return some data to a user requesting it.  Your first impression might be to use \"fopen\" or \"fsockopen\" to make a connection to the webserver and get the data.  \r\n\r\nConsider something for a moment.  This bot is running on one process, one thread.  Say that you were sending a file to someone, and you also went to query a webpage.  What if the webpage was extremely bogged down with traffic?  The query would block, and the file transfer would stall.  To rectify this, I implemented a few procedures for querying outside servers, including webservers.  This eliminates the blocking problem, as the connections are handled by php-irc.\r\n\r\nThere are two basic ways to communicate with the outside world easily in PHP-IRC.\r\n\r\n1) Use $this->ircClass->addQuery()\r\n2) Utilize the connection class manually\r\n\r\nThe addQuery() method is a specialized way of using the 'connection' class to get the job done.  In other words, you could write your own connection.php class method that does exactly what addQuery does, or even more if you wanted.  The irc bot itself uses the connection class to connect to irc servers, run dcc chats, and even run file transfers.  You can even use the connection class to start a listening socket, which can be used to write servers such as http servers, ftp servers, or pretty much anything that uses a tcp socket.\r\n\r\n=================================================\r\n9-a. Basic Queries, using the addQuery() function\r\n=================================================\r\n\r\nThis method is used mostly for retrieving data from http servers.  It's main advantage is that it is incredibly easy to use, but the main disadvantage is that you can only send one query per connection, and then data related to that query is returned before the connection is terminated.\r\n\r\nThe basic procedure is this:  You will run a function with a query, and specify what function to run when data has been recieved from that server.  Then, the function, using a specifically defined prototype, will have access to all the data + results from the server as soon as the query is complete.\r\n\r\nFunctions used in this process are:\r\n\r\nirc::addQuery($host, $port, $query, $line, $class, $function)\r\nsocket::generateGetQuery($query, $host, $path, $httpVersion = \"1.0\")  <-- $httpVersion can be omitted\r\nsocket::generatePostQuery($query, $host, $path, $httpVersion = \"1.0\") <-- $httpVersion can be omitted\r\n\r\nThese functions, (addQuery, generateGetQuery, and generatePostQuery) are outlined in the command_reference.txt file.  But here is how it works:\r\n\r\nFor instance, if you wanted to parse data at animenfo.com, you would do this:\r\n\r\nDefine a function in your module file.  We'll call it \"query\" for now.  Also, see the previous section for information about how to make this method accessable (by editing function.conf)\r\n\r\n  public function query($line, $args)\r\n  {\r\n    $query = \"search=naruto&queryin=anime_titles&action=Go&option=smart\";\r\n    $getQuery = socket::generateGetQuery($query, \"www.animenfo.com\", \"/search.php\");\r\n    $this->ircClass->addQuery(\"www.animenfo.com\", 80, $getQuery, $line, $this, \"queryTwo\");\r\n  }\r\n\r\nNotice the \"queryTwo\".  Now define another function in your module file.  We'll call it \"queryTwo\".\r\n\r\n  public function queryTwo($line, $args, $result, $response)\r\n  {\r\n    \r\n  }\r\n\r\nThe function, \"queryTwo\" will be run as soon as a response is recieved from the server, and the response will be stored in the '$response' variable.  The result of the query will be stored in the '$result' variable.  For instance, if there was an error on query,  $result will equal QUERY_ERROR, and the error message will be stored in $response.  If there is no error, $result will equal QUERY_SUCCESS.\r\n\r\nNotice\r\n------\r\nAs of version 2.1.1, the socket::httpGetQuery, and socket::httpPostQuery functions were removed.  They were replaced with the addQuery function.\r\n\r\n================================================\r\n9-b. Intro to Connection Class, Advanced Queries\r\n================================================\r\n\r\nAs the development of PHP-IRC 2.2.0 continued, a need for a connection layer to the socket class appeared.  Code was being repeated often in the irc bot class, the dcc class, and other places; in addition, it was becoming quite cluttered and hard to understand.  Also, the old way just simply didn't work anymore with the process queue method implmented in 2.2.0.  Therefore, the connection class was implemented to solve this problem.\r\n\r\nThe connection class serves as a layer between the socket class and the user.  A user can create a connection, specify a host and port, and the connection class will do everything else automatically; connect, send read/write events, accept connections, close connections, and much more.  This works by specifying a callback class, with pre-named, user-defined functions to accept events from the socket class.  Say, for example, whenever data is read for a specifc socket, that sockets user-assigned connection class will notify the callback class of an event, say, onRead(), and then the onRead() function in the callback class can read the data.\r\n\r\nHere's a simple schematic:\r\n\r\n+--------------+            +------------------+            +----------------+\r\n| Socket Class |->Triggers->| Connection Class |->Triggers->| Callback Class |\r\n+--------------+            +------------------+            +----------------+\r\n\r\nThe callback class can then use socket class functions, such as getQueueLine(), or what have you, to retrieve data from the socket read queue, or send data using the appropriate function.\r\n\r\nGeneral Overview\r\n----------------\r\nThere are two specific ways to run the connection class:\r\n\r\n1) Open connection to other server specifying host and port\r\n2) Listen for connections on a specific or random port, accepting new connections\r\n\r\nThe ins and outs of the callback class will then be explained.\r\n\r\nMethod One - Connecting to another server\r\n-----------------------------------------\r\nFor this method, one needs 3 things, with the fourth being optional:\r\n\r\n1) Host\r\n2) Port\r\n3) Connection timeout \r\n4) Transfer timeout\r\n\r\nThe connection timeout is how long before the connection class will think that it cannot connect to the server before timing out, and the transfer timeout is how long (after a connection has connected) before the connection class believes the connection to have failed after no activity.\r\n\r\nSay you wanted to connect to \"www.animenfo.com\" on port \"80\".  First, you need to declare a new connection:\r\n\r\n  $conn = new connection(\"www.animenfo.com\", \"80\", CONNECT_TIMEOUT);\r\n\r\nCONNECT_TIMEOUT is just the default connect timeout used by the irc class.  You can use whatever integer/float number you want.\r\n\r\n  $this->conn = $conn;\r\n\r\nYou need some way of remembering this connection; in this case, the call back class will be the one that the connection is created in.  In most cases, you will need to make a whole new class because of the need for unique functions to handle the events of any general connection.\r\n\r\n  $conn->setSocketClass($this->socketClass);\r\n  $conn->setIrcClass($this->ircClass);\r\n  $conn->setTimerClass($this->timerClass);\r\n\r\nThe connection class needs access to these three classes, socket class, irc class, and timer class.\r\n\r\n  $conn->setCallbackClass($this);\r\n\r\nThis is probably the most important call of all.  Whenever an event happens for this connection, specific functions in this class will be called to handle the event.  This is explained more thouroughly below in the \"Ins and Outs\" of the callback class sub-section.\r\n\r\n  $conn->init();\r\n\r\nThis will try to create the socket with the socket class.\r\n\r\nAlso, optionally here you can specify transfer timeout.  That would look like this:\r\n\r\n  $conn->setTransTimeout($timeout);\r\n\r\nWhere $timeout is in seconds or fractions of seconds.\r\n\r\n  if ($conn->getError())\r\n  {\r\n    $this->ircClass->notice($line['fromNick'], \"Error connecting: \" . $conn->getErrorMsg() );\r\n  }\r\n\r\nIf there was a problem init()'ing the connection, then $conn->getError() will be true, and $conn->getErrorMsg() will be why.\r\n\r\n  $this->sockInt = $conn->getSockInt();\r\n\r\nThe sockInt is necessary to use socket class functions for this socket.\r\n\r\n  $conn->connect();\r\n\r\nThe final step, this will start the connection process to the server.\r\n\r\nMethod Two - Listening for Connections\r\n--------------------------------------\r\nThis method follows reletively the same method as for connecting to a server.  There are two slight differences:\r\n\r\n1) Specify the host as null when creating a connection, and specify the connect timeout as zero.\r\n\r\n  $conn = new connection(null, \"80\", 0);\r\n\r\nYou can change the \"80\" to null to listen on a random port.\r\n\r\n2) Do not run $conn->connect();\r\n\r\nThis function is used ONLY when connecting to a server.  It has no purpose otherwise.\r\n\r\nThe Ins and Outs of the Callback Class\r\n--------------------------------------\r\nOkay, so now we know how to create a listening connection or a connect connection.  Now what do we do with it?  We have to have some way of responding to the events.  A callback class must have seven pre-named functions:\r\n\r\nclass my_class {\r\n\r\n  public function onTransferTimeout($connection)\r\n  {\r\n  }\r\n\r\n  public function onConnectTimeout($connection)\r\n  {\r\n  }\r\n\r\n  public function onConnect($connection)\r\n  {\r\n  }\r\n\r\n  public function onRead($connection)\r\n  {\r\n    return true; (or return false;)\r\n  }\r\n\r\n  public function onWrite($connection)\r\n  {\r\n  }\r\n\r\n  public function onAccept($listener, $newConnection)\r\n  {\r\n  }\r\n\r\n  public function onDead($connection)\r\n  {\r\n  }\r\n\r\n}\r\n\r\nEach function is pretty self explanitory.  The only one that might cause some confusion is onRead() or onAccept().\r\n\r\nonRead()\r\n--------\r\nThis function returns true if not all data has been read from the socket (i.e., you used socketClass->getQueueLine() but want to give other processes a chance to run before you continue processing).  This will make the function run immediately again.  Otherwise, returning false will signal to the connection class that you don't need to run this function again.\r\n\r\nonAccept()\r\n----------\r\nListener is the connection that was listening for new connections, and $newConnection is the new connection.  $newConnection is another object of type connection class, and all one needs to do is call getSockInt() on it to get the socket identifier.  The callback class is automatically its parents callback class ($listener's callback class).  This can be changed by runing the setCallbackClass() function again with a different class.\r\n\r\nClosing a connection\r\n--------------------\r\nThis is very important.  The connection class will, under no circumstances, close a connection.  Even if the onDead() function is called, for instance, the callback class MUST close the connection.  If you have a connection, $conn, and you want to close it, you would run:\r\n\r\n$conn->disconnect();\r\n\r\nThis kills the socket, and removes it from the socket class.  From this point on, it is completely inactive.\r\n\r\nWhat if I want to accept a connection, but close the parent connection in the process?\r\n--------------------------------------------------------------------------------------\r\nThe dcc class is a sample class that does just this.\r\n\r\n  public function onAccept($oldConn, $newConn)\r\n  {\r\n    $this->conn = $newConn;\r\n    //We just want to use $newConn from now on\r\n\r\n    $this->sockInt = $newConn->getSockInt();\r\n    //Get $newConn's sockint\r\n\r\n    $oldConn->disconnect();\r\n    //Close our old connection\r\n\r\n    $this->onConnect($newConn);\r\n    //Trigger the onConnect event\r\n  }\r\n\r\n============================\r\n10. Custom DCC Chat sessions\r\n============================\r\n\r\nA custom dcc chat handler is where you send out a chat request to a user, and instead of php-irc's default dcc interface handling and parsing the input, you will handle and parse the input yourself.  Just follow the template.txt in the modules directory to create your handler.  However, in addition, you need to do a few extra things.\r\n\r\nYou will need to include these functions:\r\n\r\n  public function main($line, $args)\r\n  {\r\n    $port = $this->dccClass->addChat($line['fromNick'], null, null, false, $this);\r\n\r\n    if ($port === false)\r\n    {\r\n      $this->ircClass->notice($line['fromNick'], \"Error starting chat, please try again.\", 1);\r\n    }\r\n  }\r\n\r\n  public function handle($chat, $args)\r\n  {\r\n  }\r\n\r\n  public function connected($chat)\r\n  {\r\n  }\r\n\r\n  //Following function added for 2.2.1\r\n  public function disconnect($chat)\r\n  {\r\n  }\r\n  \r\n'main' function\r\n---------------\r\nThis is the function that your trigger in function.conf will call to initiate the chat\r\n\r\n'handle' function\r\n-----------------\r\nWhenever something is typed in the dcc chat window, it will be passed to this function in the '$args' array.  See the previous section for the general definition of this array.\r\n\r\n'connected' function\r\n--------------------\r\nUse this function to do any \"upon connection\" tasks, as in setup the session or whatever you want.\r\n\r\nfileserver.php is a module that uses a custom dcc chat handler, and is detailed below.\r\n\r\n\r\n'disconnected' function\r\n-----------------------\r\nThis is called when a dcc chat session is closed.\r\n\r\n==============================\r\n10-a. Simple File Server (SFS)\r\n==============================\r\n\r\nI've include a small, not-to-complex fileserver which you can use as an example to create your own modules. This particular one is a custom dcc chat handler (refer to previous section).  To activate, uncomment the  'ctcp files' section and 'file fileserver' section in the function.conf (you can change 'files' to whatever you want, its your trigger).  Then edit these variables in fileserver.php:\r\n\r\nprivate $vDir = \"F:/BT/\"; (use forward slashes, with a trailing slash as shown)\r\nprivate $maxSends = 3;\r\nprivate $maxQueues = 15;\r\nprivate $queuesPerPerson = 1;\r\nprivate $sendsPerPerson = 1;\r\n\r\nvDir is the root directory of the fileserver.  I haven't beta tested this too much.  If it breaks, tell me I guess.  It was meant as a demonstration rather than something to actually be used.\r\n\r\n====================\r\n11. Database support\r\n====================\r\n\r\nPHP-IRC offers ever increasing database support.  It currently offers a tried and tested mysql database abstraction layer(dba), and a beta postgre dba.  There is also a new \"ini\" database type which operates out of ini files.  This is similar to mIRC's /writeini and $readini functions.\r\n\r\n=====================\r\n11-a. MySQL Database\r\n=====================\r\n\r\nTo use a mysql database, you will need to uncomment and fill out the database settings in bot.conf.  You will also want to make sure that you have php set to use mysql.  View the \"Installing PHP 5\" section for more information about this.\r\n\r\nYou will need to set 'usedatabase' in bot.conf to this:\r\n\r\nusedatabase mysql\r\n\r\nINPORTANT DATABASE INFO:\r\n------------------------\r\nBecause PHP does not escape input from sockets as it does with get/post/cookies (from http), you need to escape your database information before you put it into the database.  Therefore, if you have a table with 3 fields like ... name, password, email, then the safest way to put this information into  the database using the db class provided in the bot would be:\r\n\r\n$fieldArray = array(\"Somebody's Name\", \"somePass\", \"something@something.com\");\r\n\r\n$this->db->query(\"INSERT INTO sometable (name,password,email) values ('[1]','[2]','[3]')\", $fieldArray);\r\n\r\nThis ensures that the data is safe to put into the database.  The [1] etc will be replaced with their place in the array above in real time.  Of course, you are free to do it however you wish.\r\n\r\n======================\r\n11-b. Postgre Database\r\n======================\r\n\r\nYou will need to set 'usedatabase' in bot.conf to this:\r\n\r\nusedatabase postgre\r\n\r\nAlso, read \"IMPORTANT DATABASE INFO\" above for more information.  Support for this dba is SKETCHY at best.\r\n\r\n=========================================================\r\n11-c. Serverless, mIRC compatible ini-file based Database\r\n=========================================================\r\n\r\nINI-file support compliments the database system provided by PHP-IRC.  Say you have a simple module which only needs to store a few data to file.  Instead of having to have a mysql database, you can achieve this feat with ini files.  They are basically identical to mIRC ini files--so, if you have any experience with $readini or /writeini, you will be pretty well off.\r\n\r\nTo use ini files, there are several functions you can perform:\r\n\r\n1) Declaring, Creating, or Opening an INI file\r\n2) Setting ini values\r\n3) Retrieving ini values\r\n4) Writing changes to ini file\r\n5) Miscellaneous ini-file functions.\r\n\r\n1 - Declaring, Creating, or Opening an INI file\r\n-----------------------------------------------\r\nCreating or opening an ini file is incredibly simple.  In fact, they consist of the same step:\r\n\r\n$myIni = new ini(\"somefile.ini\");\r\n\r\nThats it!  Then:\r\n\r\nif ($myIni->getError())\r\n{\r\n\t//some code to handle ini file error\r\n}\r\n\r\nIf this is false, then the ini file cannot be created.  In this case, you need to check the permissions on the directory you're attempting to create this file. (It may be that you don't have read access either.)\r\n\r\nNow you are ready to import/export data.  One idea you may use is saving the $myIni variable in a global variable in your module, and then using it just as if it was a database, running queries and updating data occasionally.\r\n\r\n2 - Setting ini values\r\n----------------------\r\nINI files consist of three types of data.  Sections, Variables, and Values.  They look somewhat like this:\r\n\r\n[section]\r\nvariable=value\r\nanother_variable=value\r\n[section2]\r\n\r\netc....\r\n\r\nTo set an ini value on ini-object \"$myIni\", use the following function:\r\n\r\n$myIni->setIniVal($section, $variable, $value);\r\n\r\nNone of these arguments may contain a newline character.\r\n\r\n3 - Retrieving ini values\r\n-------------------------\r\nThere are many many ways of retrieving data from an ini object.  To assist, there are around ten helper functions:\r\n\r\n1) getSections() //get all section names\r\n2) sectionExists() //check whether a section exists\r\n3) getSection() //get all vars in a section, associative array form\r\n4) randomSection() //get a random section\r\n5) randomVar() //get a random variable in a section\r\n6) searchSections() //see command_reference.txt\r\n7) searchVars() //see command_reference.txt ... etc\r\n8) searchSectionsByVar()\r\n9) searchVals()\r\n10) numSections()\r\n11) numVars()\r\n12) getVars()\r\n\r\nPerhaps the most important function is getIniVal($section, $var).  See command_reference.txt for more detailed function information.\r\n\r\n4 - Writing changes to ini file\r\n-------------------------------\r\nWhen you want to finalize changes to an ini database, and write the data to a file, call this command:\r\n\r\n$myIni->writeIni();\r\n\r\nThis will write the ini file.  You can continue editing, and then use this function again as many times as you wish.\r\n\r\n\r\n5 - Miscellaneous ini-file functions\r\n------------------------------------\r\nThere are some other useful functions.  See command_reference.txt for more info.\r\n\r\n1) deleteVar($section, $var)\r\n2) deleteSection($section)\r\n3) getSection($section)\r\n\r\n==========\r\n12. Timers\r\n==========\r\n\r\nTimers allow you to run some procedure or function later, but not have to actually \"run\" it later.  You specify a delay, and the script will run it in the interval selected.  Timers are used all over php-irc.  The point here is that you can also use them.  \r\n\r\nTimer functions look like this:\r\n\r\n  public function myfunc($arguments)\r\n  {\r\n\treturn true/false;\r\n  }\r\n\r\nThis form is declared more readily in the section titled \"Modules and User-defined functions\".  By default, a timer will expire upon running, and will not be run again.  To change this so that the timer runs again in another interval, the timer function MUST return 'true':\r\n\r\nreturn true;\r\n\r\nThis will signal the timer class to run the timer again after 'interval'.  Otherwise, the timer is removed.\r\n\r\nIf I wanted to create a timer to run a function in sixty seconds, I would do this:\r\n\r\n$this->timerClass->addTimer(\"my_timer\", $this, \"myfunc\", \"\", 60, false);\r\n\r\nThe arguments are as follows:\r\n$name\t\t- The timer's name.  Used with removeTimer to remove the timer\r\n$class\t\t- pointer to class with function, usually '$this'\r\n$function\t- the function that you will want to run after the interval expires\r\n$args\t\t- the arguments you want to send to the timer\r\n$interval\t- duh, in seconds and fractions of seconds (i.e., 5.2)\r\n$runRightAway\t- whether this timer should run as soon as it is added, or wait until after the interval. 'true' or 'false'.\r\n\r\nA few notes:\r\n------------\r\n\r\n$name\r\n-----\r\nIf you want to create a random name to send as timer title, with least chance for name collision, use:\r\n\r\nirc::randomHash();\r\n\r\nThis function will generate a string which should be unique.\r\n\r\n$args\r\n-----\r\nThis can be anything you want, from a class, to an array, to an object.  I have the 'argClass' defined in defines.php which I use to send multiple variables to my timers:\r\n\r\n$args = new argClass;\r\n\r\n$args->arg1 = \"blah\";\r\netc...\r\n\r\nOtherwise, you could just send an associative array.\r\n\r\nRemoving Timers\r\n---------------\r\nIn order to remove a timer, you will need to use this function:\r\n\r\n$this->timerClass->removeTimer($name);\r\n\r\nThe \"$name\" variable is the same as the name variable declared with addTimer above.  Make sure that you specify unique timer names.  Also, make sure that you keep track of the timer name if you are going to want to delete it.  You can usually do this by sending it via the $args variable.\r\n\r\nInstead of relying on removeTimer, I many times simply return false instead of true when the timer is next run.  That is also possible.\r\n\r\n===================================\r\n13. Multiple bots under one process\r\n===================================\r\n\r\nThis script supports running multiple bots under one process.  In order to do this, create another bot.conf file, say, bot2.conf, and just specify it when starting the bot:\r\n\r\n./bot.php bot.conf bot2.conf bot3.conf\r\n\r\netc.  See the \"Running\" section for more information.  Performance of multiple bots has been significantly increased in 2.2.0.\r\n\r\n\r\n===========================\r\n14. Provided Sample Modules\r\n===========================\r\nTo foster continued support of PHP-IRC; I have included some basic module examples in this release.  Please note that a parser can and will fail when the html of a site is changed, so some of these releases may NOT work at future dates.  They all worked previous to 01/14/05, however.\r\n\r\n=================\r\n14-a. IMDB Parser\r\n=================\r\nThis module parses the internet movie database, http://www.imdb.com \r\n\r\nTo use, uncomment the following line from function.conf\r\n\r\n;include modules/imdb/imdb_mod.conf\r\n\r\nThe command is \"!imdb\".  You can do a search by using \"!imdb <query>\".  If multiple dates were found for your query, you can do: \"!imdb <title> (date)\" to see it's results.  Note that the parenthesis on the date must be there.\r\n\r\nNote, as this is a parser, it may not work out of the box, as imdb might have changed their site.\r\n\r\n===========================================\r\n14-b. Quotes mod with mysql/ini file system\r\n===========================================\r\nPossibily the most usable feature of any bot, this bot comes with two different forms of quote systems.  You can either utilize a mysql database, or use the onboard ini file database.\r\n\r\nMysql\r\n-----\r\nTo use, uncomment in function.conf:\r\n\r\n;include modules/quotes_sql/quote_mod.conf\r\n\r\nYou must also set the database information in bot.conf, and run this query in the database:\r\n\r\ncreate table quotes (id int default null, deleted tinyint(1) default 0, author varchar(50) default \"\", quote text, channel varchar(100) default \"\", time int, key(id));\r\n\r\nSee modules/quotes_sql/quotes_mod.conf for usable commands.\r\n\r\nIni\r\n---\r\nTo use, uncomment in function.conf:\r\n\r\n;include modules/quotes_ini/quote_mod.conf\r\n\r\nQuotes are stored in the included \"quotes_database\" directory.\r\n\r\nSee modules/quotes_ini/quotes_mod.conf for usable commands.\r\n\r\n========================\r\n14-c. Simple http server\r\n========================\r\nAlright, this is more of a proof of concept than something actually usable.  This shows off the use of PHP-IRC's new \"connection\" class to handle incoming http connections in an event based way.\r\n\r\nI really know just about nothing about the http protocol, thus I give no support or instructions for this module.  I have had it display pages and images with much success.\r\n\r\nTo use, uncomment in function.conf:\r\n\r\n;include modules/httpd/httpd_mod.conf\r\n\r\nThen, the bot will listen on the port specified in modules/httpd/http.ini which defaults to 5050.\r\n\r\n=====================\r\n14-d. Bash.org Parser\r\n=====================\r\nThis will allow users to display random, searched, or specific quotes from http://bash.org\r\n\r\nThe commands are:\r\n\r\n!bash - random quote\r\n!bash + - random positive quote\r\n!bash search - search for a quote, will display the first result containing 'search'\r\n!bash id - will return the specific quote with id 'id'.\r\n\r\nTo use, uncomment in function.conf:\r\n\r\n;include modules/bash/bash_mod.conf\r\n\r\n==============================\r\n14-e. News System/Rules Script\r\n==============================\r\nThis is a small standard script where users can type a trigger and information will come back to them.  It can be used to generate !rules scripts, !news scripts, or pretty much anything you can think of.  To use it, uncomment the appropriate line (referring to news_mod.conf) in function.conf.  Then, you can use the default trigger, !news, to add stuff.  You must be opped/admined to add/delete items.\r\n\r\nHere are the commands:\r\n\r\n!news <command> <arguments>\r\n\r\ncommand:\r\nadd - add a new item to end of list.  You can also add to a specific line number, by doing add <num> <stuff>\r\ndel - delete a line number: del <num>\r\nshow - show line numbers with their respective lines, so you can use del.\r\nclear - clear out all lines for a specific channel.\r\n\r\nRunning the command with no arguments is available to everyone, and will show the lines in order of line number.\r\n\r\nThe usefulness of this mod is very apparent.  However, to make it even more useful, I've added another feature.  Say that you have these two items in news_mod.conf:\r\n\r\npriv !news true true true 0 news_mod priv_news\r\npriv !requests true true true 0 news_mod priv_news\r\n\r\nBoth of these are pointing to the same function/module, but they will both access separate database files.  Thats right, separate.  That is because any call to the function will make the function open the database that is of the same name as the trigger.  For instance, doing:\r\n\r\n!news add Hello! This is some news!\r\n\r\nThis will add the line to the news database.  And doing:\r\n\r\n!requests add Some Request\r\n\r\nThis will add the line to the requests database, but they use the same module/function!  Cool huh :)\r\n\r\n===========================\r\n14-f.\tSeen System (beta!)\r\n===========================\r\nThis is a very beta mod which I wrote like 15 minutes prior to releasing this version of php-irc.  Basically, it works as a normal seen mod would, you type !seen <user> and it tells you the last time it saw that person.  It uses the ini file system to store information.  This mod is VERY BETA!!! I haven't even tested 85% of it.  I ran it once and thought, \"heh, interesting\", and never looked at it again.  I will not support this mod until either someone updates it and sends me a better revision, or I get the time to make it better.\r\n\r\n========================\r\n14-g. Request Ads System\r\n========================\r\nThis has been around since the early days of php-irc.  It is the classic example.  Except in 2.2.0, it now utilizes the ini file system, so ads that are added are saved and restarted when the bot process is killed and restarted.  The \"!ad\" trigger is on by default.\r\n\r\n======================\r\n15. Function Reference\r\n======================\r\nPlease view the \"command_reference.txt\" file for a complete indepth look at all the functions that you can use while writing your modules.\r\n\r\n==================\r\n16. Special Thanks\r\n==================\r\nI would like to thank some of the recent regulars to #manekian @ irc.rizon.net for helping beta test this release:\r\n\r\nho0ber\r\nnefus\r\n\r\n=====\r\nPS...\r\n=====\r\nCircular references are the devil!\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}